import React, { useState, useEffect } from 'react';
import "../styles/DevicePopup.css";
import CircularSlider from "./CircularSlider";
import { doc, getDoc, updateDoc } from "firebase/firestore";

const FanPopup = ({ device, onClose }) => {
    const [mode, setMode] = useState("Cool");

    useEffect(() => {
        const fetchFanDevice = async () => {
            if (!device?.id) return; 
            
            const fanRef = doc(database, "devices", device.id);
            const snapshot = await getDoc(fanRef);
            
            if (snapshot.exists()) {
                const fanData = snapshot.data();
                setMode(fanData.mode || "Cool");
            }
        };

        fetchFanDevice();
    }, [device?.id]);

    useEffect(() => {
        const updateMode = async () => {
            if (!device?.id) return;
            
            const fanRef = doc(database, "devices", device.id);
            await updateDoc(fanRef, { mode });
        };

        updateMode();
    }, [mode, device?.id]);

    return (
        <div className="popup-overlay">
            <div className="popup-container">
             
                <div className="popup-header">
                    <button onClick={onClose}>←</button>
                    <h2>{device.name}</h2>
                    <button>⋮</button>
                </div>

               
                <div className="temperature-container">
                    <div>
                        <CircularSlider />
                    </div>
                </div>

                <div className="mode-grid">
                    {["Heat", "Cool", "Dry", "Fan"].map((m) => (
                        <button
                            key={m}
                            onClick={() => setMode(m)}
                            className={`mode-button ${mode === m ? "active" : ""}`}
                        >
                           
                            {m === "Heat" && (
                               <svg
                                    width="38"
                                    height="38"
                                    viewBox="0 0 38 38"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    className="mode-icon"
                                >
                                    <path d="M19.0001 25.3333C15.5072 25.3333 12.6667 22.4928 12.6667 19C12.6667 15.5072 15.5072 12.6667 19.0001 12.6667C22.4929 12.6667 25.3334 15.5072 25.3334 19C25.3334 22.4928 22.4929 25.3333 19.0001 25.3333Z" stroke="currentColor"/>
                                    <path d="M19.0001 5.54166V8.70832M32.4584 19H29.2917M8.70841 19H5.54175M19.0001 29.2917V32.4583M26.1251 11.875L28.5001 9.49999M9.50008 28.5L11.8751 26.125M9.50008 9.49999L11.8751 11.875M26.1251 26.125L28.5001 28.5" stroke="currentColor" strokeLinecap="round"/>
                                </svg>
                                
                            )}
                            {m === "Cool" && (
                                  <svg
                                  width="29"
                                  height="29"
                                  viewBox="0 0 29 29"
                                  fill="none"
                                  xmlns="http://www.w3.org/2000/svg"
                                  className="mode-icon"
                              >
                                  <path d="M14.5 2.41666V21.75M14.5 21.75V26.5833M14.5 21.75L18.125 25.375M14.5 21.75L10.875 25.375M18.125 3.62499L14.5 7.24999L10.875 3.62499M4.03586 8.45832L8.22152 10.875M8.22152 10.875L20.7785 18.125M8.22152 10.875L6.89477 5.92324M8.22152 10.875L3.26978 12.2017M20.7785 18.125L24.9642 20.5417M20.7785 18.125L25.7303 16.7982M20.7785 18.125L22.1053 23.0779M24.9642 8.45832L20.7785 10.875M20.7785 10.875L8.22152 18.125M20.7785 10.875L22.1053 5.92324M20.7785 10.875L25.7303 12.2017M8.22152 18.125L4.03586 20.5417M8.22152 18.125L3.26978 16.7982M8.22152 18.125L6.89477 23.0792" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
                              </svg>
                          
                                
                            )}
                            {m === "Dry" && (
                                <svg
                                width="19"
                                height="23"
                                viewBox="0 0 19 23"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                                className="mode-icon"
                            >
                                <path
                                    d="M13.9922 4.66308C12.7859 3.26996 11.4283 2.01548 9.94434 0.922846C9.81298 0.830826 9.65648 0.781464 9.49609 0.781464C9.33571 0.781464 9.17921 0.830826 9.04785 0.922846C7.56666 2.01594 6.21165 3.2704 5.00781 4.66308C2.32324 7.74609 0.90625 10.9961 0.90625 14.0625C0.90625 16.3417 1.81166 18.5276 3.4233 20.1392C5.03494 21.7508 7.2208 22.6562 9.5 22.6562C11.7792 22.6562 13.9651 21.7508 15.5767 20.1392C17.1883 18.5276 18.0938 16.3417 18.0938 14.0625C18.0938 10.9961 16.6768 7.74609 13.9922 4.66308ZM9.5 21.0937C7.63583 21.0917 5.84861 20.3502 4.53044 19.0321C3.21227 17.7139 2.47082 15.9267 2.46875 14.0625C2.46875 8.47363 7.88574 3.80859 9.5 2.53906C11.1143 3.80859 16.5312 8.47167 16.5312 14.0625C16.5292 15.9267 15.7877 17.7139 14.4696 19.0321C13.1514 20.3502 11.3642 21.0917 9.5 21.0937ZM14.958 14.9746C14.7554 16.1061 14.211 17.1485 13.3981 17.9612C12.5852 18.774 11.5427 19.3182 10.4111 19.5205C10.3682 19.5273 10.3248 19.5309 10.2812 19.5312C10.0853 19.5312 9.89649 19.4575 9.75231 19.3248C9.60814 19.192 9.51911 19.01 9.50288 18.8147C9.48666 18.6194 9.54443 18.4251 9.66473 18.2704C9.78502 18.1157 9.95907 18.0119 10.1523 17.9795C11.7705 17.707 13.1436 16.334 13.418 14.7129C13.4527 14.5085 13.5671 14.3263 13.7362 14.2064C13.9052 14.0864 14.115 14.0385 14.3193 14.0732C14.5237 14.1079 14.7059 14.2224 14.8258 14.3914C14.9458 14.5605 14.9937 14.7703 14.959 14.9746H14.958Z"
                                    fill="currentColor"
                                />
                            </svg>
                                
                                
                            )}
                            {m === "Fan" && (
                                 <svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                 <path fill-rule="evenodd" clip-rule="evenodd" d="M5.25 3.5C5.25 2.85721 5.44061 2.22886 5.79772 1.6944C6.15484 1.15994 6.66242 0.743378 7.25628 0.497393C7.85014 0.251408 8.50361 0.187047 9.13404 0.312449C9.76448 0.437851 10.3436 0.747384 10.7981 1.2019C11.2526 1.65642 11.5622 2.23552 11.6876 2.86596C11.813 3.4964 11.7486 4.14986 11.5026 4.74372C11.2566 5.33758 10.8401 5.84516 10.3056 6.20228C9.77114 6.55939 9.14279 6.75 8.5 6.75H2C1.80109 6.75 1.61032 6.67098 1.46967 6.53033C1.32902 6.38968 1.25 6.19891 1.25 6C1.25 5.80109 1.32902 5.61032 1.46967 5.46967C1.61032 5.32902 1.80109 5.25 2 5.25H8.5C8.84612 5.25 9.18446 5.14737 9.47225 4.95507C9.76003 4.76278 9.98434 4.48947 10.1168 4.1697C10.2492 3.84993 10.2839 3.49806 10.2164 3.15859C10.1489 2.81913 9.98218 2.50731 9.73744 2.26256C9.4927 2.01782 9.18087 1.85115 8.84141 1.78363C8.50194 1.7161 8.15007 1.75076 7.8303 1.88321C7.51053 2.01567 7.23722 2.23997 7.04493 2.52775C6.85264 2.81554 6.75 3.15388 6.75 3.5V3.857C6.75 4.05591 6.67098 4.24668 6.53033 4.38733C6.38968 4.52798 6.19891 4.607 6 4.607C5.80109 4.607 5.61032 4.52798 5.46967 4.38733C5.32902 4.24668 5.25 4.05591 5.25 3.857V3.5ZM13.25 5.5C13.25 4.65943 13.4993 3.83774 13.9663 3.13883C14.4333 2.43992 15.097 1.89519 15.8736 1.57351C16.6502 1.25184 17.5047 1.16768 18.3291 1.33166C19.1536 1.49565 19.9108 1.90042 20.5052 2.4948C21.0996 3.08917 21.5043 3.84645 21.6683 4.67087C21.8323 5.49529 21.7482 6.34982 21.4265 7.12641C21.1048 7.90299 20.5601 8.56675 19.8612 9.03375C19.1623 9.50074 18.3406 9.75 17.5 9.75H1C0.801088 9.75 0.610322 9.67098 0.46967 9.53033C0.329018 9.38968 0.25 9.19891 0.25 9C0.25 8.80109 0.329018 8.61032 0.46967 8.46967C0.610322 8.32902 0.801088 8.25 1 8.25H17.5C18.0439 8.25 18.5756 8.08872 19.0278 7.78654C19.4801 7.48437 19.8325 7.05488 20.0407 6.55238C20.2488 6.04988 20.3033 5.49695 20.1972 4.9635C20.091 4.43006 19.8291 3.94005 19.4445 3.55546C19.0599 3.17086 18.5699 2.90895 18.0365 2.80284C17.5031 2.69673 16.9501 2.75119 16.4476 2.95933C15.9451 3.16747 15.5156 3.51995 15.2135 3.97218C14.9113 4.42442 14.75 4.9561 14.75 5.5V6C14.75 6.19891 14.671 6.38968 14.5303 6.53033C14.3897 6.67098 14.1989 6.75 14 6.75C13.8011 6.75 13.6103 6.67098 13.4697 6.53033C13.329 6.38968 13.25 6.19891 13.25 6V5.5ZM2.25 12C2.25 11.8011 2.32902 11.6103 2.46967 11.4697C2.61032 11.329 2.80109 11.25 3 11.25H17.5C18.3406 11.25 19.1623 11.4993 19.8612 11.9663C20.5601 12.4333 21.1048 13.097 21.4265 13.8736C21.7482 14.6502 21.8323 15.5047 21.6683 16.3291C21.5043 17.1536 21.0996 17.9108 20.5052 18.5052C19.9108 19.0996 19.1536 19.5044 18.3291 19.6683C17.5047 19.8323 16.6502 19.7482 15.8736 19.4265C15.097 19.1048 14.4333 18.5601 13.9663 17.8612C13.4993 17.1623 13.25 16.3406 13.25 15.5V15C13.25 14.8011 13.329 14.6103 13.4697 14.4697C13.6103 14.329 13.8011 14.25 14 14.25C14.1989 14.25 14.3897 14.329 14.5303 14.4697C14.671 14.6103 14.75 14.8011 14.75 15V15.5C14.75 16.0439 14.9113 16.5756 15.2135 17.0278C15.5156 17.4801 15.9451 17.8325 16.4476 18.0407C16.9501 18.2488 17.5031 18.3033 18.0365 18.1972C18.5699 18.0911 19.0599 17.8291 19.4445 17.4445C19.8291 17.06 20.091 16.5699 20.1972 16.0365C20.3033 15.5031 20.2488 14.9501 20.0407 14.4476C19.8325 13.9451 19.4801 13.5156 19.0278 13.2135C18.5756 12.9113 18.0439 12.75 17.5 12.75H3C2.80109 12.75 2.61032 12.671 2.46967 12.5303C2.32902 12.3897 2.25 12.1989 2.25 12Z" fill="#4C4A4A"/>
                                 </svg>
                                 
                            )}
                            <span>{m}</span>
                        </button>
                    ))}
                </div>
            </div>
        </div>
    );
};

export default FanPopup;